{% extends 'common/base.html' %}


{% load crispy_forms_tags %}
{% load static %}
{%load index%}

{% block content %}

    <center>

      <h2>Auditor Comment</h2>

    <form method="post" action=".">

        {% csrf_token %}
        <table>
          <table  class="table table-striped table-bordered table-sm">
              <tr>
                  <th>Audit Type</th>
                  <td>{{ auditschedule.schedule_auditype.audittype }}</td>
              </tr>
              <tr>
                  <th>Audit Date</th>
                  <td>{{ auditschedule.schedule_audit_date }}</td>
              </tr>
              <tr>
                  <th>Audit Code</th>
                  <td>{{auditschedule.schedule_audit_code}}</td>
              </tr>
              <tr>
                  <th>Auditor's Name</th>
                  <td>{% for o in auditschedule.schedule_auditor_list.all %}{{o.auditors.emp_name}} / {% endfor %}</td>
              </tr>
              <tr>
                  <th>Auditee's Name</th>
                  <td>{% for o in auditschedule.schedule_auditee_list.all %}{{o.emp_name}} / {% endfor %}</td>
              </tr>
              </table>

                  <!--below class is important for scrip working -->
                    <table style="table table-bordered table-striped; width:100%" class=" table order-list" id="myTable">
                    <tbody>
                        <tr>
                            <th>ISO Ref no</th>
                            <th>Activity Title</th>
                            <th>Evidence (By Auditor)</th>
                            <th>Status</th>
                            <th>Department</th>

                        </tr>
                        <input type="hidden" id="totallength" name="totallength"/>
                        {%if auditschedule.id not in acid %}

                            {%for wkm in workmanual%}
                              <tr>
                                <td><textarea name="cls_refno" rows="3" cols="10" readonly>{{wkm.cls_ref_no}}</textarea></td>
                                <td><textarea name="description" rows="3" cols="30" readonly>{{wkm.activity_title}}</textarea></td>
                                <td>{{form.auditor_comments}}</td>
                                <td>{{form.comment_status}}</td>
                                <td>{{form.department}}</td>
                                <input type="hidden" name="workmanual_id" value="{{wkm.id}}">

                              </tr>
                            {%endfor%}

                        {%else%}

                                {{ formset.management_form|crispy }}

                                    {% for form in formset.forms %}

                                            <tr class="{% cycle 'row1' 'row2' %} formset_row-{{ formset.prefix }}">
                                                {% for field in form.visible_fields %}
                                                <td>
                                                    {# Include the hidden fields in the form #}
                                                    {% if forloop.first %}
                                                        {% for hidden in form.hidden_fields %}
                                                            {{ hidden }}
                                                        {% endfor %}
                                                    {% endif %}
                                                    {{ field.errors.as_ul }}

                                                    {{ field }}
                                                </td>
                                                {% endfor %}
                                            </tr>
                                    {% endfor %}

                        {%endif%}

                          <!-- <div>
                          <br>
                          <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
                          </script>
                          <script src="{% static 'js/formset.js' %}">
                          </script>
                          <script type="text/javascript">
                              $('.formset_row-{{ formset.prefix }}').formset({
                                  addText: 'add',
                                  deleteText: 'remove',
                                  prefix: '{{ formset.prefix }}',
                              });
                          </script> -->

                        </tbody>
                        </table>
                    </table>


<!--

                          </table>
                        {%if auditschedule.id in ac_ash_id%}
                          {%for ac in auditcomments%}
                            {%if ac.auditschedule_id == auditschedule.id%}
                          <tr>
                                <td><textarea class='form-control' name="cls_refno" readonly>{{ac.cls_refno}}</textarea></td>
                                <td><textarea class='form-control' name="description" readonly>{{ac.description}}</textarea></td>
                                <td><textarea class='form-control' name="auditor_comments" rows="3" cols="50">{{ac.auditor_comments}}</textarea></td>
                              <td><select class='form-control' style='height:30px;' name="comment_status">
                              {%for value,text in status%}
                              <option value="{{value}}"{%if ac.comment_status == value %} selected {%endif%}>{{text}}</option>
                              {%endfor%}
                            </select></td>
                              <td><select class='form-control' style='height:30px;' name="department">
                              <option value="">Select</option>
                              {%for dept in employeedept%}
                              <option value="{{dept.id}}"{%if ac.department.id == dept.id %} selected {%endif%}>{{dept.dept_code}}</option>
                              {%endfor%}
                            </select> </td>
                            <input type="hidden" name="auditschedule_id" value="{{auditschedule.id}}">
                            <input type="hidden" name="workmanual_id" value="{{ac.workmanual_id}}">
                            <input type="hidden" name="aid" value="{{ac.id}}">
                          </tr>
                            {%endif%}
                          {%endfor%}
                        {%else%}
                          {%for wkm in workmanual%}
                           <tr>
                             <td><textarea class='form-control' name="cls_refno" readonly>{{wkm.cls_ref_no}}</textarea></td>
                             <td><textarea class='form-control' name="description" readonly>{{wkm.activity_title}}</textarea></td>
                               <td >{{form.auditor_comments}}</td>
                               <td>{{form.comment_status}}</td>

                               <td>{{form.department}}</td>
                               <input type="hidden" name="auditschedule_id" value="{{auditschedule.id}}">
                               <input type="hidden" name="workmanual_id" value="{{wkm.id}}">
                            </tr>
                              {%endfor%}
                         {%endif%}

                                <tr>
                                  <td class="col-sm-2"><a class="deleteRow"></a></td>
                                </tr>

                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="6" style="text-align: left;">
                                <input type="button" class="btn btn-lg btn-block " id="addrow" value="Add Row" />
                            </td>
                        </tr>
                        <tr>
                        </tr>
                    </tfoot>
                  </table>
                </td>
              </tr>
          </table> -->

          <link href="{% static 'css/bootstrap.min.css' %} rel="stylesheet" id="bootstrap-css">

          <script src="{% static 'js/min3.5.1.js' %}">
          </script>

          <script type="text/javascript" src="{% static 'js/min.js' %}">
          </script>

          <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}">
          </script>


  <script type="text/javascript">

              $(function(){
         var i =0;

        $("#addrow").click(function(){
            var AnswerHTML = "";
            AnswerHTML ='<tr><td><textarea  rows="2" cols="10" name="cls_refno' + i +'" readonly>0</textarea></td>'
          +' <td><textarea rows="3" cols="30" name="description' + i +'" readonly>General</textarea></td>'
          +' <td><textarea rows="3" cols="50" name="auditor_comments' + i +'" required></textarea></td>'
          +' <td><select style="height:30px;"  name="comment_status' + i +'" required><option value="">---Select---</option><option value="0">C</option><option value="1">OFI</option><option value="2">NC</option></select></td>'
          +' <td><select style="height:30px;"  name="department' + i +'" required><option value="">---Select---</option>{%for dept in employeedept%}<option value="{{dept.id}}">{{dept.dept_code}}</option>{%endfor%}</select></td>'
          +' <td><input type="button" class="ibtnDel btn btn-md btn-danger" value="Delete"></td></tr>';

        $("table.order-list").append(AnswerHTML);
        i++;
          $("#totallength").val(i);

        });
        });

          $("table.order-list").on("click", ".ibtnDel", function (event) {
          $(this).closest("tr").remove();
          i -= 1
          });



            //   $(document).ready(function () {
            // var counter = 0;
            //
            // $("#addrow").on("click", function () {
            //
            // var text= "<tr><td><textarea class='form-control' name='cls_refno" + counter +"'>0</textarea></td>"
            //          +"<td><textarea class='form-control' name='description" + counter +"'>General</textarea></td>"
            //          +"<td><textarea class='form-control' rows='3' cols='50' name='auditor_comments" + counter +"'></textarea></td>"
            //
            //          +"<td><select style='height:30px;' name='comment_status" + counter +"'><option value=''>-select-</option><option value='0'>C</option><option value='1'>OFI</option><option value='2'>NC</option></select></td>"
            //          +"<td><select style='height:30px;' name='department" + counter +"'><option value=''>-select-</option>{%for dept in employeedept%}<option value='{{dept.id}}'>{{dept.dept_code}}</option>{%endfor%}</select></td>"
            //          +"<td><input type='button' class='ibtnDel btn btn-md btn-danger' value='Delete'></td></tr>";
            //
            //
            // $("table.order-list").append(text);
            // counter++;
            // });
            //
            //
            //
            // $("table.order-list").on("click", ".ibtnDel", function (event) {
            // $(this).closest("tr").remove();
            // counter -= 1
            // });
            //
            //
            // });
            //
            //
            //
            // function calculateRow(row) {
            // var price = +row.find('input[name^="price"]').val();
            //
            // }
            //
            // function calculateGrandTotal() {
            // var grandTotal = 0;
            // $("table.order-list").find('input[name^="price"]').each(function () {
            // grandTotal += +$(this).val();
            // });
            // $("#grandtotal").text(grandTotal.toFixed(2));
            // }
            //

     </script>


    <div style="text-align:center">
      <input type="button" class="btn btn-success" id="addrow" value="ADD"/>
      <button type="submit" class="btn btn-success">Save</button>
      <a href="{% url 'QMS:auditscheduleview' %}" class="btn btn-success">Back<span class="glyphicon glyphicon-step-backward"></span></a>
      <a href="{% url 'QMS:sendmailauditor' auditschedule.id %}" class="btn btn-success">Submit</a>

    </div>

    </form>

    </center>


{% endblock %}
